# -------------------------------
# Chunk 158 â€” FileWatcher, TreeCache, TaskScheduler, RecentFiles Services
# -------------------------------

echo ""
echo "Creating Chunks 158 files..."

# ------------------------------------------------------
# FileWatcherService.java
# ------------------------------------------------------
cat << 'EOF' > "$UI_PKG/FileWatcherService.java"
package com.explorer.ui;

import java.io.IOException;
import java.nio.file.*;
import java.util.*;
import java.util.concurrent.CopyOnWriteArrayList;

/**
 * FileWatcherService
 *  - Watches a folder for changes (create/delete/modify)
 *  - Listeners can subscribe to events
 *  - Uses a single background thread
 */
public class FileWatcherService {

    public interface Listener {
        void onEvent(WatchEvent.Kind<?> kind, Path child);
    }

    private final List<Listener> listeners = new CopyOnWriteArrayList<>();
    private WatchService watchService;
    private Thread worker;
    private volatile boolean running = false;

    public void start(Path folder) throws IOException {
        stop();

        watchService = FileSystems.getDefault().newWatchService();
        folder.register(
            watchService,
            StandardWatchEventKinds.ENTRY_CREATE,
            StandardWatchEventKinds.ENTRY_DELETE,
            StandardWatchEventKinds.ENTRY_MODIFY
        );

        running = true;
        worker = new Thread(this::process, "FileWatcherService");
        worker.setDaemon(true);
        worker.start();
    }

    public void stop() {
        running = false;
        if (watchService != null) {
            try { watchService.close(); } catch (Exception ignored) {}
        }
        if (worker != null) {
            try { worker.interrupt(); } catch (Exception ignored) {}
        }
    }

    private void process() {
        while (running) {
            WatchKey key;
            try {
                key = watchService.take();
            } catch (Exception e) {
